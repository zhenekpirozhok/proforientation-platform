# Database & Migrations (PostgreSQL)

## üìå –û–ø–∏—Å–∞–Ω–∏–µ
–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **PostgreSQL** –≤ Docker.  
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∏–¥–µ **–º–∏–≥—Ä–∞—Ü–∏–π** –≤ –ø–∞–ø–∫–µ [`db/migration`](./db/migration).  
–§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞–º **Flyway**:

```

V<–Ω–æ–º–µ—Ä>\_\_<–æ–ø–∏—Å–∞–Ω–∏–µ>.sql

````

–ü—Ä–∏–º–µ—Ä—ã:
- `V1__init_schema.sql` ‚Äî –ø–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã
- `V2__add_index_users_email.sql` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω –∏–Ω–¥–µ–∫—Å
- `V3__add_professions_table.sql` ‚Äî –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

‚ö†Ô∏è –í–∞–∂–Ω–æ: –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º.  
–ù–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è = –Ω–æ–≤—ã–π —Ñ–∞–π–ª `V<next_number>__description.sql`.

---

## üöÄ –ó–∞–ø—É—Å–∫ –±–∞–∑—ã –ª–æ–∫–∞–ª—å–Ω–æ

### 1. –ü–æ–¥–Ω—è—Ç—å PostgreSQL
```bash
docker compose up -d
````

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–∞–∑–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –≤—Å–µ SQL –∏–∑ `db/migration/`.

### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ

```bash
docker exec -it postgres_db psql -U myuser -d mydb
```

–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤–Ω—É—Ç—Ä–∏ `psql`:

```sql
\dt           -- —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
\d table_name -- –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
```

---

## üõ† –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

1. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ `db/migration/` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º:

   ```
   V2__add_tests_table.sql
   ```
2. –ù–∞–ø–∏—à–∏ SQL —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º (–Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞, –∏–Ω–¥–µ–∫—Å, –ø–æ–ª–µ –∏ —Ç.–¥.)
3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:

   * –î–ª—è –Ω–æ–≤–æ–π –±–∞–∑—ã: –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å volume (`docker volume rm project_postgres_data`) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å `docker compose up -d`
   * –í –±—É–¥—É—â–µ–º (—Å Flyway): –º–∏–≥—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ backend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## üë®‚Äçüíª –†–∞–±–æ—Ç–∞ Java-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (–±—É–¥—É—â–µ–µ)

–ö–æ–≥–¥–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è Java-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:

* –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ [`db/migration`](./db/migration) –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤
  `backend/src/main/resources/db/migration`
* –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è **Flyway** –≤ Spring Boot
* Flyway —Å–∞–º –Ω–∞–∫–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

